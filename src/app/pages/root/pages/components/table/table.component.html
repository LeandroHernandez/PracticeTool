<!-- <p>table works!</p> -->
<main class="main">
  <div class="actual_selection">
    <div class="selectedItem_div">
      @if (actualSelectedItems.length > 0 || setOfCheckedId.size > 0) {
      <span class="selectedItem_span"> You have selected <span class="number"> {{actualSelectedItems.length > 0 ?
          actualSelectedItems.length : setOfCheckedId.size }} </span>
        items </span>
      <span> - </span>
      <button type="button" class="button-clear" (click)="clearSelectedItems()" title="Clear selected items">
        Clear <i class="bi bi-eraser-fill"></i>
      </button>
      }
    </div>
  </div>
  @if ( itemList && paginatedItems.length > 0 || actualSelectedFilters ) {
  <div class="filters_section">
    <div class="filterButton_div">
      @if (filterFormFields) {
      <button type="button" class="button-show" (click)="showFiltersModal()" title="Filter">
        Filter <i class="bi bi-filter"></i>
      </button>
      @if (actualSelectedFilters) {
      <button type="button" class="button-clear" (click)="clearFilters()" title="Clear Filters">
        Clear <i class="bi bi-eraser-fill"></i>
      </button>
      }
      }
    </div>

    @if (modifyAction && actualSelectedItems.length > 1) {
    <button class="button-delete-all" nz-popconfirm nzPopconfirmTitle="Sure to delete all of selected items?"
      (nzOnConfirm)="deleteAllAction.emit(true)" title="Delete all selection">
      Delete selection
      <i class="bi bi-trash"></i>
    </button>
    }
  </div>
  }
  <div class="table-container {{ startsWithCondition ? 'special' : 'regular' }}">
    @if ( !itemList ) {
    <p class="loading-p"> Charging files <nz-icon nzType="loading" nzTheme="outline" /> </p>
    } @else {
    @if ( paginatedItems.length > 0 ) {
    <table class="table">
      <thead class="thead">
        <tr class="tr">
          <th class="th" [nzChecked]="checked" [nzIndeterminate]="indeterminate" nzLabel="Select all"
            (nzCheckedChange)="onAllChecked($event)"></th>
          <th class="th">#</th>
          @for(item of tableInfo; track $index) {
          <th class="th">
            {{ item.header }}
            <!-- @if ( item.filter ) {
            <button class="button-filter" nz-popover nzPopoverTrigger="click" [nzPopoverContent]="menu"> <i
                class="bi bi-search"></i> </button>
            <ng-template #menu>
              <form [formGroup]="form" class="form">
                <fieldset class="fieldset">
                  <div class="input-box">
                    <label class="label-input">

                      <div class="span-label-div">
                        @for (letter of letters( localLanguage === 'en' ? 'Select' : 'Seleccionar' ); track $index) {
                        <span class="span-letter" [style.--i]="$index"> {{letter}} </span>
                        }
                      </div>
                      <nz-select nzMode="multiple" nzAllowClear [formControlName]="item.key.split('.')[0]" class="">
                        @for (item of usesList; track item) {
                        <nz-option [nzLabel]=" item.name" [nzValue]="item.id"></nz-option>
                        }
                      </nz-select>

                    </label>
                  </div>
                </fieldset>
              </form>
              @if (item.filter === 'multiselect') {}
            </ng-template>
            } -->
          </th>
          }
          @if ( !startsWithCondition ) {
          <th class="th">Actions</th>
          }
        </tr>
      </thead>
      <tbody class="tbody">
        @for(item of paginatedItems; track item.id) {
        <tr class="tr {{ ($index + 1) % 2 === 0 ? 'pair' : '' }} ">
          <td class="td" [nzChecked]="setOfCheckedId.has(item.id)" [nzDisabled]="item.disabled" [nzLabel]="item.name"
            (nzCheckedChange)="onItemChecked(item.id, $event)"></td>
          <td class="td">{{ getItemIndex(item.id) }}</td>
          @for(keyItem of tableInfo; track $index) {
          <td class="td {{ getClass(item, keyItem) }}">
            @if (keyItem.key === 'meanings') {
            @if ( item.uses ) {
            @for (use of item.uses; track $index; let i = $index) {
            <span>
              [
              <span class="useName">{{ use.name }}:</span>
            </span>
            @for (meaning of use.meanings; track $index; let j = $index) {
            {{ meaning }}
            @if (use.meanings.length > 1 && j + 1 < use.meanings.length) { <span> - </span>
              }
              }
              <span>]</span>
              }
              }
              @else {
              @for (meaning of item[keyItem.key]; track $index; let i = $index) {
              {{ meaning }}
              @if (item[keyItem.key].length > 1 && i + 1 < item[keyItem.key].length) { <span> - </span>
                }
                }
                }
                }

                @else if ( keyItem.key ==='list' ) {
                <span> {{ item.list.length }} </span>
                }
                @else {
                @if ( keyItem.key === 'createdAt' || keyItem.key === 'lastUpdate' ) {
                {{ getValue(item, keyItem) | date: 'EEEE, d/M/y, h:mm:ss a' }}
                } @else if (keyItem.key === 'state') {
                <div class="div-state">
                  <nz-switch nzCheckedChildren="Active" nzUnCheckedChildren="Inactive"
                    [ngModel]=" getValue(item, keyItem) "
                    (ngModelChange)="changeState({ id: item.id, state: $event })"></nz-switch>
                </div>
                } @else {
                {{ getValue(item, keyItem) }}
                }
                }
          </td>
          }
          @if ( !startsWithCondition ) {
          <td class="td actions_td">
            <i [class]="!modifyAction ? 'bi bi-pencil-square -disabled' : 'bi bi-pencil-square' " title="Edit Word"
              (click)=" modifyAction ? editAction.emit(item.id) : false"></i>
            @if (modifyAction) {
            <i nz-popconfirm nzPopconfirmTitle="Sure to delete?" (nzOnConfirm)="deleteAction.emit(item.id)"
              class="bi bi-x-circle" title="Delete Word"></i>
            } @else {
            <i class=" bi bi-x-circle -disabled" title="Delete Word"></i>
            }
          </td>
          }
        </tr>
        }
      </tbody>
    </table>
    } @else {
    <p class="empty-p">There are not items to show</p>
    }
    }
  </div>
  @if ( itemList && itemList.length > paginatedItems.length ) {
  <div class="paginator">
    <span class="span itemListLength"> {{ itemList.length + ' items' }} </span>
    <nz-pagination [(nzPageIndex)]="page.index" [(nzPageSize)]="page.size" [nzPageSizeOptions]="[5, 10, 20, 30, 40, 50]"
      [nzTotal]="itemList.length" [nzSize]="'default'" nzShowSizeChanger nzShowQuickJumper
      (nzPageIndexChange)="paginationChange()" (nzPageSizeChange)="paginationChange()"></nz-pagination>
  </div>
  }
</main>